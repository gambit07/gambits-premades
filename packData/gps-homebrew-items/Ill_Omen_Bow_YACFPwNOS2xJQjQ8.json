{
  "name": "Ill Omen Bow",
  "type": "weapon",
  "img": "icons/weapons/bows/shortbow-recurve-blue.webp",
  "system": {
    "description": {
      "value": "<p><span style=\"font-family:'gg sans', 'Noto Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif\">Doesn't require ammunition. When you draw the bow shadows crawl around your arm and seat themselves as an arrow in the bow.</span></p><p><span style=\"font-family:'gg sans', 'Noto Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif\">Occasionally the arrow transforms into an ill omen. (Roll 1d6 whenever you hit, on a 6 the shadowy arrows turn into phantasmal images of ill omens such as black cats, ravens, black wolves etc. When these strike their target they cause an immediate random negative effect.</span></p>",
      "chat": ""
    },
    "source": {
      "custom": "2.1.38",
      "revision": 1,
      "rules": "2014",
      "book": "",
      "page": "",
      "license": ""
    },
    "quantity": 1,
    "weight": {
      "value": 2,
      "units": "lb"
    },
    "price": {
      "value": 1000,
      "denomination": "gp"
    },
    "attunement": "required",
    "rarity": "veryRare",
    "identified": true,
    "cover": null,
    "crewed": false,
    "range": {
      "value": 150,
      "long": 600,
      "units": "ft",
      "reach": null
    },
    "uses": {
      "max": "",
      "recovery": [],
      "spent": 0
    },
    "damage": {
      "versatile": {
        "number": null,
        "denomination": null,
        "bonus": "",
        "types": [],
        "custom": {
          "enabled": false,
          "formula": ""
        },
        "scaling": {
          "mode": "",
          "number": null,
          "formula": ""
        }
      },
      "base": {
        "number": null,
        "denomination": null,
        "bonus": "",
        "types": [
          "piercing"
        ],
        "custom": {
          "enabled": true,
          "formula": "1d8 + @mod + 1"
        },
        "scaling": {
          "mode": "",
          "number": null,
          "formula": ""
        }
      }
    },
    "armor": {
      "value": null
    },
    "hp": {
      "value": null,
      "max": null,
      "dt": null,
      "conditions": ""
    },
    "properties": [
      "fir",
      "hvy",
      "two"
    ],
    "unidentified": {
      "description": "Longbow"
    },
    "type": {
      "value": "martialR",
      "baseItem": "longbow"
    },
    "container": null,
    "magicalBonus": null,
    "proficient": 1,
    "activities": {
      "dnd5eactivity000": {
        "_id": "dnd5eactivity000",
        "type": "attack",
        "activation": {
          "type": "action",
          "value": 1,
          "condition": "",
          "override": false
        },
        "consumption": {
          "targets": [],
          "scaling": {
            "allowed": false,
            "max": ""
          },
          "spellSlot": true
        },
        "description": {
          "chatFlavor": ""
        },
        "duration": {
          "concentration": false,
          "value": "",
          "units": "inst",
          "special": "",
          "override": false
        },
        "effects": [],
        "range": {
          "value": "150",
          "units": "ft",
          "special": "",
          "override": false
        },
        "target": {
          "template": {
            "count": "",
            "contiguous": false,
            "type": "",
            "size": "",
            "width": "",
            "height": "",
            "units": "ft"
          },
          "affects": {
            "count": "",
            "type": "",
            "choice": false,
            "special": ""
          },
          "prompt": true,
          "override": false
        },
        "uses": {
          "spent": 0,
          "max": "",
          "recovery": []
        },
        "attack": {
          "ability": "str",
          "bonus": "1",
          "critical": {
            "threshold": null
          },
          "flat": false,
          "type": {
            "value": "ranged",
            "classification": "weapon"
          }
        },
        "damage": {
          "critical": {
            "bonus": ""
          },
          "includeBase": true,
          "parts": []
        },
        "sort": 0,
        "name": "",
        "useConditionText": "",
        "useConditionReason": "",
        "effectConditionText": "",
        "macroData": {
          "name": "",
          "command": ""
        },
        "ignoreTraits": {
          "idi": false,
          "idr": false,
          "idv": false,
          "ida": false,
          "idm": false
        },
        "midiProperties": {
          "ignoreTraits": [],
          "triggeredActivityId": "none",
          "triggeredActivityConditionText": "",
          "triggeredActivityTargets": "targets",
          "triggeredActivityRollAs": "self",
          "autoConsume": false,
          "forceConsumeDialog": "default",
          "forceRollDialog": "default",
          "forceDamageDialog": "default",
          "confirmTargets": "default",
          "autoTargetType": "any",
          "autoTargetAction": "default",
          "automationOnly": false,
          "otherActivityCompatible": true,
          "otherActivityAsParentType": true,
          "identifier": "",
          "displayActivityName": false,
          "rollMode": "default",
          "chooseEffects": false,
          "toggleEffect": false,
          "ignoreFullCover": false,
          "removeChatButtons": "default",
          "magicEffect": false,
          "magicDamage": false,
          "noConcentrationCheck": false,
          "autoCEEffects": "default"
        },
        "isOverTimeFlag": false,
        "overTimeProperties": {
          "saveRemoves": true,
          "preRemoveConditionText": "",
          "postRemoveConditionText": ""
        },
        "otherActivityId": "",
        "otherActivityAsParentType": true,
        "attackMode": "oneHanded",
        "ammunition": "",
        "otherActivityUuid": "",
        "attackRollPerTarget": "default",
        "fumbleThreshold": 1
      }
    },
    "identifier": "ill-omen-bow",
    "ammunition": {},
    "attuned": true,
    "equipped": true
  },
  "effects": [],
  "flags": {
    "archon": {
      "uuid": "Item.dh6ZTgnE1aMbM8K0"
    },
    "core": {},
    "ddbimporter": {
      "dndbeyond": {
        "type": "Longbow",
        "damage": {
          "parts": []
        },
        "classFeatures": [],
        "restrictions": [],
        "filterType": "Weapon",
        "isConsumable": false,
        "isContainer": false,
        "isCustomItem": false,
        "isHomebrew": false,
        "isMonkWeapon": false,
        "isPack": false,
        "levelInfusionGranted": null,
        "tags": [
          "Damage",
          "Combat"
        ],
        "sources": [
          {
            "sourceId": 1,
            "pageNumber": null,
            "sourceType": 2
          },
          {
            "sourceId": 2,
            "pageNumber": null,
            "sourceType": 1
          }
        ]
      },
      "id": 0,
      "entityTypeId": 0,
      "definitionEntityTypeId": 1782728300,
      "definitionId": 37,
      "originalName": "Longbow",
      "version": "3.4.42",
      "overrideId": "NONE",
      "ignoreIcon": false,
      "ignoreItemImport": true,
      "ignoreItemForChrisPremades": false,
      "retainResourceConsumption": false,
      "ignoreItemUpdate": false,
      "effectsApplied": true,
      "chrisEffectsApplied": true,
      "chrisPreEffectName": "Longbow"
    },
    "scene-packer": {
      "sourceId": "Actor.PpeGTVYvVoFsdZZD.Item.lQaqA7Hq2Z9KlAng",
      "hash": "ad6d440b84d6fdeb96c1d1244224b8dddf29ca81"
    },
    "autoanimations": {
      "id": "087c42b0-4af3-4eda-9528-2b3a359ae438",
      "label": "Ill Omen Bow",
      "levels3d": {
        "type": "explosion",
        "data": {
          "color01": "#FFFFFF",
          "color02": "#FFFFFF",
          "spritePath": "modules/levels-3d-preview/assets/particles/dust.png"
        },
        "sound": {
          "enable": false
        },
        "secondary": {
          "enable": false,
          "data": {
            "color01": "#FFFFFF",
            "color02": "#FFFFFF",
            "spritePath": "modules/levels-3d-preview/assets/particles/dust.png"
          }
        }
      },
      "macro": {
        "enable": false
      },
      "meleeSwitch": {
        "video": {
          "dbSection": "range",
          "menuType": "weapon",
          "animation": "arrow",
          "variant": "regular",
          "color": "regular"
        },
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        },
        "options": {
          "detect": "automatic",
          "range": 2,
          "returning": false,
          "switchType": "on"
        }
      },
      "menu": "melee",
      "primary": {
        "video": {
          "dbSection": "melee",
          "menuType": "weapon",
          "animation": "club",
          "variant": "01",
          "color": "white",
          "enableCustom": false,
          "customPath": ""
        },
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        },
        "options": {
          "contrast": 0,
          "delay": 0,
          "elevation": 1000,
          "isWait": false,
          "opacity": 1,
          "playbackRate": 1,
          "repeat": 1,
          "repeatDelay": 250,
          "saturate": 0,
          "size": 1,
          "tint": false,
          "tintColor": "#FFFFFF",
          "zIndex": 1
        }
      },
      "secondary": {
        "enable": false,
        "video": {
          "dbSection": "static",
          "menuType": "spell",
          "animation": "curewounds",
          "variant": "01",
          "color": "blue",
          "enableCustom": false,
          "customPath": ""
        },
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        },
        "options": {
          "addTokenWidth": false,
          "anchor": "0.5",
          "contrast": 0,
          "delay": 0,
          "elevation": 1000,
          "fadeIn": 250,
          "fadeOut": 500,
          "isMasked": false,
          "isRadius": true,
          "isWait": false,
          "opacity": 1,
          "repeat": 1,
          "repeatDelay": 250,
          "saturate": 0,
          "size": 1.5,
          "tint": false,
          "tintColor": "#FFFFFF",
          "zIndex": 1
        }
      },
      "soundOnly": {
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        }
      },
      "source": {
        "enable": false,
        "video": {
          "dbSection": "static",
          "menuType": "spell",
          "animation": "curewounds",
          "variant": "01",
          "color": "blue",
          "enableCustom": false,
          "customPath": ""
        },
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        },
        "options": {
          "addTokenWidth": false,
          "anchor": "0.5",
          "contrast": 0,
          "delay": 0,
          "elevation": 1000,
          "fadeIn": 250,
          "fadeOut": 500,
          "isMasked": false,
          "isRadius": false,
          "isWait": true,
          "opacity": 1,
          "repeat": 1,
          "repeatDelay": 250,
          "saturate": 0,
          "size": 1,
          "tint": false,
          "tintColor": "#FFFFFF",
          "zIndex": 1
        }
      },
      "target": {
        "enable": false,
        "video": {
          "dbSection": "static",
          "menuType": "spell",
          "animation": "curewounds",
          "variant": "01",
          "color": "blue",
          "enableCustom": false,
          "customPath": ""
        },
        "sound": {
          "enable": false,
          "delay": 0,
          "repeat": 1,
          "repeatDelay": 250,
          "startTime": 0,
          "volume": 0.75
        },
        "options": {
          "addTokenWidth": false,
          "anchor": "0.5",
          "contrast": 0,
          "delay": 0,
          "elevation": 1000,
          "fadeIn": 250,
          "fadeOut": 500,
          "isMasked": false,
          "isRadius": false,
          "opacity": 1,
          "persistent": false,
          "repeat": 1,
          "repeatDelay": 250,
          "saturate": 0,
          "size": 1,
          "tint": false,
          "tintColor": "#FFFFFF",
          "unbindAlpha": false,
          "unbindVisibility": false,
          "zIndex": 1
        }
      },
      "isEnabled": false,
      "isCustomized": false,
      "fromAmmo": false,
      "version": 5
    },
    "midi-qol": {
      "onUseMacroName": "[preDamageRollComplete]ItemMacro",
      "fumbleThreshold": null,
      "effectActivation": false,
      "removeAttackDamageButtons": "default",
      "itemCondition": "",
      "reactionCondition": "",
      "otherCondition": "",
      "effectCondition": "",
      "rollAttackPerTarget": "default"
    },
    "midiProperties": {
      "confirmTargets": "default",
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "autoFailFriendly": false,
      "autoSaveFriendly": false,
      "rollOther": false,
      "critOther": false,
      "offHandWeapon": false,
      "magicdam": true,
      "magiceffect": true,
      "concentration": false,
      "toggleEffect": false,
      "ignoreTotalCover": false,
      "noConcentrationCheck": false,
      "idr": false,
      "idi": false,
      "idv": false,
      "ida": false
    },
    "dae": {
      "macro": {
        "name": "Ill Omen Bow",
        "img": "icons/weapons/bows/shortbow-recurve-blue.webp",
        "type": "script",
        "scope": "global",
        "command": "const target = workflow.hitTargets.first();\n\nif (target) {\n  let effectData1 = [{\n    \"origin\": macroItem.uuid,\n    \"duration\": {\n      \"seconds\": 99999\n    },\n    \"disabled\": false,\n    \"name\": \"Blinded\",\n    \"img\": macroItem.img,\n    \"type\": \"base\",\n    \"changes\": [\n      {\n        \"key\": \"macro.StatusEffect\",\n        \"mode\": 0,\n        \"value\": \"blinded\",\n        \"priority\": 20\n      }\n    ],\n    \"transfer\": false,\n    \"flags\": {\n      \"dae\": {\n        \"specialDuration\": [\n          \"turnEndSource\"\n        ]\n      }\n    },\n  }];\n\n  let effectData2 = [{\n    \"origin\": macroItem.uuid,\n    \"duration\": {\n      \"seconds\": 99999\n    },\n    \"disabled\": false,\n    \"name\": \"Restrained\",\n    \"img\": macroItem.img,\n    \"type\": \"base\",\n    \"changes\": [\n      {\n        \"key\": \"macro.StatusEffect\",\n        \"mode\": 0,\n        \"value\": \"restrained\",\n        \"priority\": 20\n      }\n    ],\n    \"transfer\": false,\n    \"flags\": {\n      \"dae\": {\n        \"specialDuration\": [\n          \"turnEndSource\"\n        ]\n      }\n    },\n  }];\n\n  let effectData3 = [{\n    \"origin\": macroItem.uuid,\n    \"duration\": {\n      \"seconds\": 99999\n    },\n    \"disabled\": false,\n    \"name\": \"Stunned\",\n    \"img\": macroItem.img,\n    \"type\": \"base\",\n    \"changes\": [\n      {\n        \"key\": \"macro.StatusEffect\",\n        \"mode\": 0,\n        \"value\": \"stunned\",\n        \"priority\": 20\n      }\n    ],\n    \"transfer\": false,\n    \"flags\": {\n      \"dae\": {\n        \"specialDuration\": [\n          \"turnEnd\"\n        ]\n      }\n    },\n  }];\n\n  let effectData4 = [{\n    \"origin\": macroItem.uuid,\n    \"duration\": {\n      \"seconds\": 60\n    },\n    \"disabled\": false,\n    \"name\": \"Poisoned\",\n    \"img\": macroItem.img,\n    \"type\": \"base\",\n    \"changes\": [\n      {\n        \"key\": \"macro.StatusEffect\",\n        \"mode\": 0,\n        \"value\": \"poisoned\",\n        \"priority\": 20\n      }\n    ],\n    \"transfer\": false\n  }];\n\n  let effectData5 = [{\n    \"origin\": macroItem.uuid,\n    \"disabled\": false,\n    \"name\": \"Prone\",\n    \"img\": macroItem.img,\n    \"type\": \"base\",\n    \"changes\": [\n      {\n        \"key\": \"macro.StatusEffect\",\n        \"mode\": 0,\n        \"value\": \"prone\",\n        \"priority\": 20\n      }\n    ],\n    \"transfer\": false\n  }];\n\n  const effects = [\n    // Define the 5 effects and their names here, along with animation data\n    {\n      name: \"Blinded\",\n      effectData: effectData1,\n      animation: {\n        file: \"jb2a.arrow.physical.white.02\",\n        // Add any other animation settings you want here\n      },\n    },\n    {\n      name: \"Poisoned\",\n      effectData: effectData2,\n      animation: {\n        file: \"jb2a.arrow.poison.green.02\",\n        // Add any other animation settings you want here\n      },\n    },\n    {\n      name: \"Prone\",\n      effectData: effectData3,\n      animation: {\n        file: \"jb2a.arrow.cold.purple\",\n        // Add any other animation settings you want here\n      },\n    },\n    {\n      name: \"Restrained\",\n      effectData: effectData4,\n      animation: {\n        file: \"jb2a.arrow.fire.orange\",\n        // Add any other animation settings you want here\n      },\n    },\n    {\n      name: \"Stunned\",\n      effectData: effectData5,\n      animation: {\n        file: \"jb2a.arrow.lightning.red\",\n        // Add any other animation settings you want here\n      },\n    },\n  ];\n\n  async function getRandomEffect(target) {\n    const rollResult = await new Roll(\"1d6\").evaluate();\n    rollResult.toMessage();\n\n    if (rollResult.total === 6) {\n      // Get the effects that are already applied to the target\n      const appliedEffects = target.actor.appliedEffects.map(effect => effect.name);\n\n      // Find all available effects that are not already applied to the target\n      const availableEffects = effects.reduce((filtered, effect) => {\n        if (!appliedEffects.includes(effect.name)) {\n          filtered.push(effect);\n        }\n        return filtered;\n      }, []);\n\n      if (availableEffects.length > 0) {\n        return availableEffects[Math.floor(Math.random() * availableEffects.length)];\n      }\n    }\n\n    return null;\n  }\n\n  async function applyEffect(target, effectData, animationData) {\n    console.log(effectData, \"effectData\")\n    await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: target.actor.uuid, effects: effectData });\n    ui.notifications.info(`Applied ${effectData[0].name} to ${target.actor.name}, Ill Omens are in full effect.`);\n\n    if (animationData) {\n\t   let seq0 = new Sequence()\n      .effect()\n      .atLocation(token)\n      .file(\"jb2a.energy_strands.in.purple.01.1\")\n\t  .fadeIn(500)\n      .fadeOut(500)\n\t  .scale(0.5)\n\t  \n      let seq1 = new Sequence()\n        .effect()\n        .atLocation(token)\n        .stretchTo(target)\n        .file(animationData.file)\n\t\t\n    await seq0.play()\n    await Sequencer.Helpers.wait(1200)\n    await seq1.play()\n    }\n  }\n\n  if (!target) {\n    ui.notifications.warn(`No targets selected.`);\n  } else {\n    const selectedEffect = await getRandomEffect(target);\n    if (selectedEffect) {\n      await applyEffect(target, selectedEffect.effectData, selectedEffect.animation);\n    } else {\n      ui.notifications.warn(`Dice roll was not a 6, Ill Omens are dormant.`);\n\t     new Sequence()\n      .effect()\n      .atLocation(token)\n      .stretchTo(target)\n      .file(\"jb2a.arrow.physical.white.01\")\n      .play();\n    }\n  }\n} else {\n  ui.notifications.warn(`No ill omens here.`);\n}",
        "author": "roRDywD19pu2VxlC",
        "ownership": {
          "default": 3
        },
        "_id": null,
        "folder": null,
        "sort": 0,
        "flags": {},
        "_stats": {
          "systemId": "dnd5e",
          "systemVersion": "4.3.6",
          "coreVersion": "12.331",
          "createdTime": null,
          "modifiedTime": null,
          "lastModifiedBy": null,
          "compendiumSource": null,
          "duplicateSource": null
        }
      }
    },
    "chris-premades": {
      "info": {
        "source": "gambits-premades",
        "version": "0.0.24"
      }
    },
    "dnd5e": {
      "last": {
        "dnd5eactivity000": {
          "attackMode": "twoHanded",
          "damageType": {
            "0": "piercing"
          }
        }
      },
      "riders": {
        "activity": [],
        "effect": []
      }
    },
    "crux": {
      "trayVisibility": "default"
    }
  },
  "folder": null,
  "_id": "YACFPwNOS2xJQjQ8",
  "_key": "!items!YACFPwNOS2xJQjQ8"
}
